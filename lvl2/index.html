<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- Meta Tags Básicos -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- SEO Meta Tags -->
    <title>
      Clasificación de Personas | Ejercicio de Lógica de Programación
    </title>
    <meta
      name="description"
      content="Sistema interactivo de clasificación de personas usando operadores condicionales lógicos (Y, O, NO). Aprende lógica de programación arrastrando y soltando entidades según condiciones específicas. Ejercicio educativo interactivo."
    />
    <meta
      name="keywords"
      content="lógica de programación, operadores condicionales, clasificación de personas, ejercicios interactivos, programación educativa, drag and drop, Y, O, NO, operadores lógicos, aprendizaje interactivo"
    />
    <meta name="author" content="ADN Programador" />
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="language" content="Spanish" />
    <meta name="revisit-after" content="7 days" />
    <meta name="theme-color" content="#00ffff" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="SYSTEM_QUERY.exe - Clasificación de Personas | Ejercicio de Lógica de Programación"
    />
    <meta
      property="og:description"
      content="Sistema interactivo de clasificación de personas usando operadores condicionales lógicos (Y, O, NO). Aprende lógica de programación arrastrando y soltando entidades según condiciones específicas."
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="SYSTEM_QUERY.exe - Sistema de Clasificación de Personas"
    />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:site_name" content="ADN Programador" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="SYSTEM_QUERY.exe - Clasificación de Personas"
    />
    <meta
      name="twitter:description"
      content="Sistema interactivo de clasificación usando operadores condicionales lógicos. Ejercicio educativo de lógica de programación."
    />
    <meta
      name="twitter:image:alt"
      content="SYSTEM_QUERY.exe - Sistema de Clasificación"
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./assets/favicon.png" />
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon.png" />

    <!-- Preconnect para Rendimiento -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />

    <!-- Estilos -->
    <link rel="stylesheet" href="./styles/style.css" />

    <!-- Fuentes -->
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Schema.org JSON-LD para Rich Snippets -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SYSTEM_QUERY.exe",
        "description": "Sistema interactivo de clasificación de personas usando operadores condicionales lógicos (Y, O, NO). Ejercicio educativo de lógica de programación.",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Web Browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "5",
          "ratingCount": "1"
        },
        "educationalUse": "interactive learning",
        "learningResourceType": "interactive tutorial",
        "teaches": "lógica de programación, operadores condicionales, clasificación de datos",
        "inLanguage": "es"
      }
    </script>
    <style>
      /* ============================================
   CYBERPUNK FUTURISTA - SISTEMA DE CLASIFICACIÓN
   ============================================ */

      /* Variables CSS - Colores Cyberpunk */
      :root {
        --cyber-bg: #0a0a0f;
        --cyber-dark: #050508;
        --cyber-surface: #0f0f1a;
        --cyber-surface-light: #1a1a2e;

        --neon-cyan: #00ffff;
        --neon-magenta: #ff00ff;
        --neon-purple: #a855f7;
        --neon-green: #00ff88;
        --neon-blue: #0080ff;
        --neon-pink: #ff0080;

        --glow-cyan: 0 0 20px rgba(0, 255, 255, 0.5),
          0 0 40px rgba(0, 255, 255, 0.3), 0 0 60px rgba(0, 255, 255, 0.2);
        --glow-magenta: 0 0 20px rgba(255, 0, 255, 0.5),
          0 0 40px rgba(255, 0, 255, 0.3), 0 0 60px rgba(255, 0, 255, 0.2);
        --glow-purple: 0 0 20px rgba(168, 85, 247, 0.5),
          0 0 40px rgba(168, 85, 247, 0.3), 0 0 60px rgba(168, 85, 247, 0.2);
        --glow-green: 0 0 20px rgba(0, 255, 136, 0.5),
          0 0 40px rgba(0, 255, 136, 0.3), 0 0 60px rgba(0, 255, 136, 0.2);

        --text-primary: #ffffff;
        --text-secondary: #b8b8d4;
        --text-accent: var(--neon-cyan);

        --border-thin: 1px solid rgba(0, 255, 255, 0.3);
        --border-medium: 2px solid rgba(0, 255, 255, 0.5);
        --border-thick: 3px solid var(--neon-cyan);
      }

      /* Reset y Base */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: "Rajdhani", "Courier New", monospace;
        background: var(--cyber-bg);
        color: var(--text-primary);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
        padding: 20px;
        line-height: 1.6;
      }

      /* Fondo Cyberpunk Grid */
      .cyber-grid {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(0, 255, 255, 0.03) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        pointer-events: none;
        z-index: 0;
        animation: gridMove 20s linear infinite;
      }

      @keyframes gridMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(50px, 50px);
        }
      }

      /* Scan Line Effect */
      .scan-line {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          var(--neon-cyan),
          transparent
        );
        box-shadow: var(--glow-cyan);
        animation: scanLine 3s linear infinite;
        z-index: 1000;
        pointer-events: none;
      }

      @keyframes scanLine {
        0% {
          top: 0;
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          top: 100%;
          opacity: 0;
        }
      }

      /* Container Principal */
      .container {
        max-width: 1600px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
        padding: 20px;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 20px;
        background: rgba(15, 15, 26, 0.6);
        border: var(--border-thin);
        border-radius: 8px;
        backdrop-filter: blur(10px);
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
      }

      .logo-terminal {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .terminal-prompt {
        color: var(--neon-green);
        font-size: 2.5rem;
        font-weight: 900;
        text-shadow: var(--glow-green);
        animation: blink 1s infinite;
      }

      @keyframes blink {
        0%,
        49% {
          opacity: 1;
        }
        50%,
        100% {
          opacity: 0.3;
        }
      }

      .cyber-title {
        font-family: "Orbitron", monospace;
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 900;
        color: var(--text-primary);
        text-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan),
          0 0 30px var(--neon-cyan);
        letter-spacing: 3px;
        margin: 0;
      }

      .code-symbol {
        color: var(--neon-purple);
        text-shadow: var(--glow-purple);
      }

      .subtitle {
        font-size: clamp(0.9rem, 2vw, 1.2rem);
        color: var(--text-secondary);
        margin-top: 15px;
        line-height: 1.8;
      }

      .code-comment {
        color: #6b7280;
        font-style: italic;
      }

      .code-operator {
        color: var(--neon-magenta);
        font-weight: 600;
        text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
      }

      /* Paneles con Efecto Glow */
      .panel-glow {
        background: rgba(15, 15, 26, 0.7);
        border: var(--border-thin);
        border-radius: 8px;
        backdrop-filter: blur(10px);
        margin-bottom: 30px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .panel-glow::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .panel-glow:hover::before {
        left: 100%;
      }

      .panel-glow:hover {
        border-color: var(--neon-cyan);
        box-shadow: var(--glow-cyan);
      }

      .panel-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px 20px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: var(--border-thin);
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--neon-green);
        box-shadow: var(--glow-green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.2);
        }
      }

      .panel-title {
        font-family: "Orbitron", monospace;
        font-size: clamp(0.85rem, 1.5vw, 1rem);
        font-weight: 700;
        color: var(--neon-cyan);
        text-transform: uppercase;
        letter-spacing: 2px;
        flex: 1;
      }

      .data-count {
        font-size: 0.85rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .panel-content {
        padding: 25px;
      }

      /* Instrucciones */
      .instructions {
        margin-bottom: 30px;
      }

      .instruction-text {
        font-size: clamp(1rem, 2vw, 1.3rem);
        color: var(--text-primary);
        font-weight: 500;
        line-height: 1.8;
        text-align: center;
      }

      .instruction-text strong {
        color: var(--neon-magenta);
        text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        font-weight: 700;
      }

      /* Navegación de Rondas */
      .round-nav {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-top: 16px;
      }

      .round-indicator {
        color: var(--text-secondary);
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .nav-btn {
        appearance: none;
        -webkit-appearance: none;
        border: var(--border-thin);
        background: rgba(0, 0, 0, 0.35);
        color: var(--text-primary);
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        line-height: 1;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease,
          border-color 0.2s ease, background 0.2s ease;
        box-shadow: 0 0 0 rgba(0, 0, 0, 0);
      }

      .nav-btn:hover {
        border-color: var(--neon-cyan);
        background: rgba(0, 255, 255, 0.08);
        box-shadow: var(--glow-cyan);
        transform: translateY(-2px);
      }

      .nav-btn:active {
        transform: translateY(0) scale(0.98);
      }

      .nav-btn:focus-visible {
        outline: none;
        border-color: var(--neon-magenta);
        box-shadow: var(--glow-magenta);
      }

      @media (max-width: 480px) {
        .nav-btn {
          width: 36px;
          height: 36px;
          font-size: 1.2rem;
        }
        .round-indicator {
          font-size: 0.95rem;
        }
      }

      /* Botón Generar Código */
      .generate-wrapper {
        display: flex;
        justify-content: center;
        margin-top: 14px;
      }

      .generate-btn {
        appearance: none;
        -webkit-appearance: none;
        padding: 10px 16px;
        border-radius: 8px;
        border: var(--border-medium);
        background: linear-gradient(
          135deg,
          rgba(0, 255, 255, 0.12),
          rgba(168, 85, 247, 0.12)
        );
        color: var(--text-primary);
        font-weight: 700;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
        box-shadow: var(--glow-cyan);
      }

      .generate-btn:hover {
        transform: translateY(-2px);
        filter: brightness(1.1);
      }

      .generate-btn:active {
        transform: translateY(0) scale(0.98);
      }

      .generate-btn:focus-visible {
        outline: none;
        border-color: var(--neon-magenta);
        box-shadow: var(--glow-magenta);
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        backdrop-filter: blur(2px);
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal-content {
        width: min(92vw, 700px);
        min-height: 280px;
        max-height: 88vh; /* permite ver todo con scroll interno */
        overflow: auto; /* scroll interno en contenido */
        background: rgba(15, 15, 26, 0.95);
        border: var(--border-thick);
        border-radius: 10px;
        box-shadow: var(--glow-purple);
      }

      .modal-sections {
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 18px;
      }

      .modal-section {
        border: var(--border-thin);
        border-radius: 8px;
        padding: 14px;
        background: rgba(0, 0, 0, 0.25);
      }

      .modal-section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 8px;
        flex-wrap: wrap; /* permite que el título y el contador no desborden */
      }

      .modal-section-title {
        font-family: "Orbitron", monospace;
        color: var(--neon-cyan);
        font-size: 0.95rem;
        margin-bottom: 10px;
      }

      .count-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 60px;
        height: 60px;
        padding: 0 16px;
        border-radius: 999px;
        border: var(--border-medium);
        background: rgba(0, 255, 255, 0.12);
        color: var(--text-primary);
        font-weight: 700;
        font-size: 2rem;
        box-shadow: var(--glow-cyan);
        margin-left: 12px;
      }

      .thumbs {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
        gap: 8px;
      }

      /* Cuerpo de sección para ubicar contador a la derecha en móvil */
      .section-body {
        display: grid; /* siempre grid para ubicar contador a la derecha */
        grid-template-columns: 1fr auto; /* imágenes a la izquierda, número a la derecha */
        align-items: start;
        gap: 10px;
      }

      .count-header {
        display: none; /* oculto en todos los tamaños */
      }

      .count-aside {
        display: inline-flex; /* visible en todos los tamaños */
        align-self: start;
      }

      .thumb {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }

      .thumb img {
        width: 48px;
        height: 48px;
        object-fit: cover;
        border-radius: 6px;
        border: var(--border-thin);
      }

      .thumb figcaption {
        font-size: 0.7rem;
        color: var(--text-secondary);
        text-align: center;
      }

      .empty-round {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Responsive: móviles */
      @media (max-width: 600px) {
        .modal-content {
          width: 96vw;
          max-height: 92vh; /* un poco más alto en móviles */
        }

        .modal-sections {
          padding: 14px;
          gap: 12px;
        }

        .modal-section {
          padding: 10px;
        }

        .modal-section-title {
          font-size: 0.9rem;
        }

        .section-body {
          display: grid; /* convierte la sección en rejilla */
          grid-template-columns: 1fr auto; /* imágenes a la izquierda, número a la derecha */
          align-items: start;
          gap: 10px;
        }

        .thumbs {
          grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
          gap: 6px;
        }

        .thumb img {
          width: 40px;
          height: 40px;
        }

        /* Mostrar sólo el contador lateral en móvil */
        .count-header {
          display: none;
        }
        .count-aside {
          display: inline-flex;
          align-self: start;
        }
      }

      .visually-hidden {
        position: absolute !important;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Main Content Grid */
      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      /* Data Pool */
      .data-pool {
        min-height: 300px;
      }

      .person-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 20px;
        padding: 25px;
        min-height: 200px;
      }

      /* Person Cards */
      .person {
        width: 100%;
        aspect-ratio: 1;
        background: var(--cyber-surface-light);
        border: var(--border-medium);
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: grab;
        user-select: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .person::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 8px;
        padding: 3px;
        background: linear-gradient(
          135deg,
          var(--neon-cyan),
          var(--neon-purple),
          var(--neon-magenta)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .person:hover {
        transform: translateY(-8px) scale(1.05);
        border-color: var(--neon-cyan);
        box-shadow: var(--glow-cyan);
        z-index: 10;
      }

      .person:hover::before {
        opacity: 1;
      }

      .person:active {
        cursor: grabbing;
        transform: translateY(-5px) scale(1.02);
      }

      .person img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
        filter: brightness(0.9) contrast(1.1);
        transition: filter 0.3s ease;
      }

      .person:hover img {
        filter: brightness(1.1) contrast(1.2);
      }

      /* Drag Container */
      .drag-container {
        min-height: 300px;
      }

      /* Feedback visual de acierto/error eliminado por requerimiento */

      .drop-zone {
        padding: 25px;
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .drop-zone:has(.person) {
        align-items: flex-start;
        justify-content: flex-start;
      }

      .drop-placeholder {
        text-align: center;
        opacity: 0.6;
        transition: opacity 0.3s ease;
        width: 100%;
      }

      .drop-zone:has(.person) .drop-placeholder {
        display: none;
      }

      .drop-icon {
        width: 60px;
        height: 60px;
        margin: 0 auto 15px;
        color: var(--neon-cyan);
        opacity: 0.5;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .drop-text {
        font-size: clamp(0.9rem, 1.5vw, 1.1rem);
        color: var(--text-secondary);
        font-weight: 400;
      }

      .drag-container .person,
      .drop-zone .person {
        cursor: default;
        width: 120px;
        height: 120px;
        flex-shrink: 0;
      }

      .drag-container .person:hover,
      .drop-zone .person:hover {
        transform: scale(1.1);
        z-index: 10;
      }

      @media (max-width: 480px) {
        .drop-zone .person {
          width: 100px;
          height: 100px;
        }
      }

      @media (max-width: 360px) {
        .drop-zone .person {
          width: 90px;
          height: 90px;
        }
      }

      /* Barra de progreso eliminada por requerimiento */

      /* Mensajes Temporales */
      .mensaje-temp {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 20px 30px;
        border-radius: 8px;
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1rem;
        z-index: 2000;
        animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        border: var(--border-medium);
        backdrop-filter: blur(10px);
        max-width: 400px;
      }

      .mensaje-temp.success {
        background: rgba(0, 255, 136, 0.2);
        border-color: var(--neon-green);
        box-shadow: var(--glow-green);
      }

      .mensaje-temp.error {
        background: rgba(255, 0, 128, 0.2);
        border-color: var(--neon-pink);
        box-shadow: 0 0 20px rgba(255, 0, 128, 0.5),
          0 0 40px rgba(255, 0, 128, 0.3);
      }

      @keyframes slideInRight {
        from {
          transform: translateX(150%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* ============================================
   RESPONSIVE DESIGN - TODOS LOS DISPOSITIVOS
   ============================================ */

      /* Tablets grandes (1024px y menos) */
      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 25px;
        }

        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
          gap: 15px;
          padding: 20px;
        }

        .container {
          padding: 15px;
        }
      }

      /* Tablets (768px y menos) */
      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .container {
          padding: 15px;
        }

        .header {
          padding: 20px 15px;
          margin-bottom: 30px;
        }

        .logo-terminal {
          flex-direction: column;
          gap: 10px;
        }

        .terminal-prompt {
          font-size: 2rem;
        }

        .panel-header {
          padding: 12px 15px;
          flex-wrap: wrap;
        }

        .panel-content {
          padding: 20px;
        }

        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
          gap: 12px;
          padding: 15px;
        }

        .drop-zone {
          padding: 20px;
        }

        .mensaje-temp {
          top: 20px;
          right: 20px;
          left: 20px;
          max-width: none;
          padding: 15px 20px;
        }
      }

      /* Móviles grandes (480px y menos) */
      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 10px;
        }

        .header {
          padding: 15px 10px;
          margin-bottom: 20px;
        }

        .cyber-title {
          font-size: 1.5rem;
          letter-spacing: 1px;
        }

        .terminal-prompt {
          font-size: 1.5rem;
        }

        .subtitle {
          font-size: 0.85rem;
          line-height: 1.5;
        }

        .panel-glow {
          margin-bottom: 20px;
        }

        .panel-header {
          padding: 10px 12px;
          gap: 8px;
        }

        .panel-title {
          font-size: 0.75rem;
          letter-spacing: 1px;
        }

        .panel-content {
          padding: 15px;
        }

        .instruction-text {
          font-size: 0.95rem;
          line-height: 1.6;
        }

        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 10px;
          padding: 12px;
        }

        .person {
          border-width: 2px;
        }

        .drop-zone {
          padding: 15px;
          min-height: 150px;
        }

        .drop-icon {
          width: 40px;
          height: 40px;
        }

        .drop-text {
          font-size: 0.85rem;
        }

        .progress-content {
          padding: 15px;
        }

        .progress-bar {
          height: 10px;
        }

        .progress-text {
          font-size: 0.9rem;
        }

        .mensaje-temp {
          top: 10px;
          right: 10px;
          left: 10px;
          padding: 12px 15px;
          font-size: 0.9rem;
        }
      }

      /* Móviles pequeños (360px y menos) */
      @media (max-width: 360px) {
        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
          gap: 8px;
        }

        .cyber-title {
          font-size: 1.2rem;
        }

        .terminal-prompt {
          font-size: 1.2rem;
        }

        .panel-title {
          font-size: 0.7rem;
        }
      }

      /* Pantallas muy grandes (1920px y más) */
      @media (min-width: 1920px) {
        .container {
          max-width: 1800px;
        }

        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
          gap: 25px;
        }
      }

      /* Orientación horizontal en móviles */
      @media (max-width: 768px) and (orientation: landscape) {
        .main-content {
          grid-template-columns: 1fr 1fr;
        }

        .person-container {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }

        .header {
          padding: 15px;
          margin-bottom: 20px;
        }
      }

      /* Altura muy pequeña */
      @media (max-height: 600px) {
        .header {
          padding: 15px;
          margin-bottom: 15px;
        }

        .panel-content {
          padding: 15px;
        }

        .person-container {
          padding: 15px;
          min-height: 150px;
        }

        .drop-zone {
          padding: 15px;
          min-height: 150px;
        }
      }

      /* Modo oscuro mejorado (siempre activo pero con ajustes) */
      @media (prefers-color-scheme: dark) {
        /* Ya está en modo oscuro por defecto */
      }

      /* Reducir animaciones para usuarios que lo prefieren */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }

        .scan-line {
          display: none;
        }
      }

      /* Impresión */
      @media print {
        .cyber-grid,
        .scan-line {
          display: none;
        }

        body {
          background: white;
          color: black;
        }

        .panel-glow {
          border: 1px solid #000;
          box-shadow: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="cyber-grid"></div>
    <div class="scan-line"></div>

    <div class="container">
      <header class="header" role="banner">
        <div class="logo-terminal">
          <span class="terminal-prompt" aria-hidden="true">&gt;</span>
          <h1 class="cyber-title">
            <span class="code-symbol" aria-hidden="true">{"</span
            >SYSTEM_QUERY<span class="code-symbol" aria-hidden="true">"}</span>
          </h1>
        </div>
        <p class="subtitle">
          <span class="code-comment"
            >// Lógica de Programación: Operadores Condicionales</span
          >
          <br />
          <span class="code-operator">if (condición) { Y | O | NO }</span>
        </p>
      </header>

      <main role="main">
        <section
          class="instructions panel-glow"
          aria-labelledby="instructions-title"
        >
          <div class="panel-header">
            <span class="status-indicator" aria-hidden="true"></span>
            <h2 class="panel-title" id="instructions-title">
              INSTRUCCIONES DEL SISTEMA
            </h2>
          </div>
          <div class="panel-content">
            <p class="instruction-text">Cargando instrucciones...</p>
            <div
              class="round-nav"
              role="toolbar"
              aria-label="Navegación de rondas"
            >
              <button
                id="btnPrev"
                class="nav-btn"
                type="button"
                aria-label="Anterior"
                title="Anterior"
              >
                &#x2039;
              </button>
              <span
                id="roundIndicator"
                class="round-indicator"
                aria-live="polite"
                >Ronda 1 / 4</span
              >
              <button
                id="btnNext"
                class="nav-btn"
                type="button"
                aria-label="Siguiente"
                title="Siguiente"
              >
                &#x203A;
              </button>
            </div>
            <div class="generate-wrapper">
              <button
                id="btnGenerate"
                class="generate-btn"
                type="button"
                aria-label="Generar código"
                title="Generar código"
                style="display: none"
              >
                Generar código
              </button>
            </div>
          </div>
        </section>

        <div class="main-content">
          <section
            class="data-pool panel-glow"
            aria-labelledby="data-pool-title"
          >
            <div class="panel-header">
              <span class="status-indicator" aria-hidden="true"></span>
              <h2 class="panel-title" id="data-pool-title">POOL DE DATOS</h2>
              <span class="data-count" id="dataCount" aria-live="polite"
                >0 entidades</span
              >
            </div>
            <div
              class="person-container"
              id="personContainer"
              role="list"
              aria-label="Lista de personas disponibles para clasificar"
            >
              <!-- Las personas se generarán dinámicamente -->
            </div>
          </section>

          <section
            class="drag-container panel-glow"
            id="dragArea"
            aria-labelledby="classification-title"
            role="region"
            aria-label="Zona de clasificación"
          >
            <div class="panel-header">
              <span class="status-indicator" aria-hidden="true"></span>
              <h2 class="panel-title" id="classification-title">
                ZONA DE CLASIFICACIÓN
              </h2>
            </div>
            <div
              class="drop-zone"
              role="application"
              aria-label="Área de destino para arrastrar personas"
            >
              <div class="drop-placeholder">
                <svg
                  class="drop-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  aria-hidden="true"
                  role="img"
                >
                  <title>Ícono de arrastrar y soltar</title>
                  <path
                    d="M12 5v14M5 12h14"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
                <p class="drop-text">
                  Arrastra las entidades aquí según las instrucciones del
                  sistema
                </p>
              </div>
            </div>
          </section>
        </div>

        <!-- Barra de progreso eliminada por requerimiento -->
      </main>
    </div>

    <!-- Scripts con defer para mejor rendimiento y SEO -->
    <script src="./scripts/person.js" defer></script>
    <script src="./scripts/script.js" defer></script>

    <!-- Modal para código generado -->
    <div id="codeModal" class="modal-overlay" aria-hidden="true">
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="codeModalTitle"
      >
        <h3 id="codeModalTitle" class="visually-hidden">Código generado</h3>
        <!-- Contenido en blanco según requerimiento -->
      </div>
    </div>

    <script>
      const caracteristicas = {
        gorra: Boolean,
        lentes: Boolean,
        edad: { niño: Boolean, adulto: Boolean },
        sexo: { hombre: Boolean, mujer: Boolean },
        ropa: { color: String },
        pelo: { largo: Boolean, corto: Boolean },
      };

      const persona1 = {
        img: "4.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Negro"),
        pelo: (caracteristicas.pelo.corto = true),
      };

      const persona2 = {
        img: "5.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Azul"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona3 = {
        img: "6.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Azul"),
        pelo: (caracteristicas.pelo.corto = true),
      };

      const persona4 = {
        img: "7.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Blanco"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona5 = {
        img: "1.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Rojo"),
        pelo: (caracteristicas.pelo.corto = true),
      };

      const persona6 = {
        img: "3.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Amarillo"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona7 = {
        img: "2.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Rojo"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona8 = {
        img: "8.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Verde"),
        pelo: (caracteristicas.pelo.corto = true),
      };

      const persona9 = {
        img: "9.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Rosa"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona10 = {
        img: "10.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = true),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Blanco"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona11 = {
        img: "11.png",
        gorra: (caracteristicas.gorra = true),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.hombre = true),
        ropa: (caracteristicas.ropa.color = "Negro"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona12 = {
        img: "12.png",
        gorra: (caracteristicas.gorra = false),
        lentes: (caracteristicas.lentes = false),
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Amarillo"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const persona13 = {
        img: "13.png",
        gorra: false,
        lentes: false,
        edad: (caracteristicas.edad.adulto = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Negro"),
        pelo: (caracteristicas.pelo.corto = true),
      };

      const persona14 = {
        img: "14.png",
        gorra: true,
        lentes: true,
        edad: (caracteristicas.edad.niño = true),
        sexo: (caracteristicas.sexo.mujer = true),
        ropa: (caracteristicas.ropa.color = "Blanco"),
        pelo: (caracteristicas.pelo.largo = true),
      };

      const personas = [
        persona1,
        persona2,
        persona3,
        persona4,
        persona5,
        persona6,
        persona7,
        persona8,
        persona9,
        persona10,
        persona11,
        persona12,
        persona13,
        persona14,
      ];
    </script>
    <script>
      // Las personas y características están disponibles globalmente desde person.js

      // Sistema de instrucciones con operadores lógicos y rondas
      let instruccionActual = null;
      const NUM_RONDAS = 4;
      let rondaActual = 0;
      let instruccionesRondas = [];
      // Estado por ronda: Set de ids en la zona de clasificación
      let estadoRondas = Array.from({ length: NUM_RONDAS }, () => new Set());

      function actualizarRoundIndicator() {
        const ind = document.getElementById("roundIndicator");
        if (ind) ind.textContent = `Ronda ${rondaActual + 1} / ${NUM_RONDAS}`;
        const btnGen = document.getElementById("btnGenerate");
        if (btnGen) {
          // Mostrar solo en la 4ta ronda
          btnGen.style.display =
            rondaActual === NUM_RONDAS - 1 ? "inline-flex" : "none";
        }
      }

      function capturarEstadoActual() {
        const dropZone = document.querySelector("#dragArea .drop-zone");
        const contenedor = dropZone
          ? dropZone
          : document.getElementById("dragArea");
        const personasEnContenedor = contenedor.querySelectorAll(".person");
        const set = new Set();
        personasEnContenedor.forEach((p) => set.add(p.id));
        estadoRondas[rondaActual] = set;
      }

      function aplicarEstadoRonda(indice) {
        const personContainer = document.querySelector(".person-container");
        const dropZone = document.querySelector("#dragArea .drop-zone");
        const destino = dropZone
          ? dropZone
          : document.getElementById("dragArea");
        const placeholder = document.querySelector(
          "#dragArea .drop-placeholder"
        );

        // Mover todas al pool primero
        document
          .querySelectorAll(".person")
          .forEach((p) => personContainer.appendChild(p));

        const set = estadoRondas[indice] || new Set();
        set.forEach((id) => {
          const el = document.getElementById(id);
          if (el) destino.appendChild(el);
        });

        // Placeholder segun estado
        if (placeholder) {
          placeholder.style.display = set.size > 0 ? "none" : "block";
        }

        // Progreso acorde al estado aplicado
        const totalCorrectas = Array.from(
          document.querySelectorAll(".person")
        ).filter((p) => validarCondiciones(p)).length;
        actualizarProgreso(set.size, totalCorrectas);
        actualizarContadorDatos();
      }

      function irA(incremento) {
        // Guardar estado actual
        capturarEstadoActual();

        // Cambiar índice de ronda (acotado 0..NUM_RONDAS-1)
        const nueva = rondaActual + incremento;
        if (nueva < 0 || nueva >= NUM_RONDAS) return;
        rondaActual = nueva;

        // Cambiar instrucción a la de la ronda
        instruccionActual = instruccionesRondas[rondaActual];
        mostrarInstruccion();
        aplicarEstadoRonda(rondaActual);
        actualizarRoundIndicator();
      }

      function configurarNavegacionRondas() {
        const btnPrev = document.getElementById("btnPrev");
        const btnNext = document.getElementById("btnNext");
        const btnGen = document.getElementById("btnGenerate");
        if (btnPrev) btnPrev.onclick = () => irA(-1);
        if (btnNext) btnNext.onclick = () => irA(1);
        if (btnGen) {
          btnGen.onclick = () => {
            // Asegurar guardar el estado actual antes de generar
            capturarEstadoActual();
            // Construir contenido del modal
            construirContenidoModal();
            const modal = document.getElementById("codeModal");
            if (!modal) return;
            modal.classList.add("show");
            modal.setAttribute("aria-hidden", "false");
          };
        }
        // Cerrar modal al hacer click en el overlay
        const modal = document.getElementById("codeModal");
        if (modal) {
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              modal.classList.remove("show");
              modal.setAttribute("aria-hidden", "true");
            }
          });
          // Cerrar con Escape
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal.classList.contains("show")) {
              modal.classList.remove("show");
              modal.setAttribute("aria-hidden", "true");
            }
          });
        }
        actualizarRoundIndicator();
      }

      function construirContenidoModal() {
        const modal = document.getElementById("codeModal");
        if (!modal) return;
        const content = modal.querySelector(".modal-content");
        if (!content) return;

        // Contenedor de secciones
        const wrapper = document.createElement("div");
        wrapper.className = "modal-sections";

        for (let i = 0; i < NUM_RONDAS; i++) {
          const section = document.createElement("section");
          section.className = "modal-section";

          const header = document.createElement("div");
          header.className = "modal-section-header";
          const title = document.createElement("h4");
          title.className = "modal-section-title";
          const instruccionTexto = instruccionesRondas[i]?.texto || "—";
          title.textContent = `Ronda ${i + 1}: ${instruccionTexto}`;

          const thumbs = document.createElement("div");
          thumbs.className = "thumbs";

          const ids = Array.from(estadoRondas[i] || []);
          // Contador en header (escritorio)
          const countHeader = document.createElement("span");
          countHeader.className = "count-badge count-header";
          countHeader.textContent = String(ids.length);
          header.appendChild(title);
          header.appendChild(countHeader);

          if (ids.length === 0) {
            const empty = document.createElement("p");
            empty.className = "empty-round";
            empty.textContent = "Sin elementos arrastrados";
            thumbs.appendChild(empty);
          } else {
            ids.forEach((pid) => {
              const el = document.getElementById(pid);
              if (!el) return;
              const img = el.querySelector("img");
              const src = img ? img.src : "";
              const alt = img ? img.alt : pid;
              const fig = document.createElement("figure");
              fig.className = "thumb";
              const thumbImg = document.createElement("img");
              thumbImg.src = src;
              thumbImg.alt = alt;
              thumbImg.loading = "lazy";
              thumbImg.decoding = "async";
              fig.appendChild(thumbImg);
              thumbs.appendChild(fig);
            });
          }

          // Contador al lado derecho de las imágenes (móvil)
          const countAside = document.createElement("span");
          countAside.className = "count-badge count-aside";
          countAside.textContent = String(ids.length);

          const body = document.createElement("div");
          body.className = "section-body";
          body.appendChild(thumbs);
          body.appendChild(countAside);

          section.appendChild(header);
          section.appendChild(body);
          wrapper.appendChild(section);
        }

        // Limpiar y montar
        content.innerHTML = "";
        content.appendChild(wrapper);
      }

      // Mapa de características de cada persona (escalable)
      // Se construye dinámicamente analizando las propiedades de cada persona
      const mapaCaracteristicas = new Map();

      // Función helper para determinar características de una persona de forma escalable
      function determinarCaracteristicasPersona(persona) {
        // Crear un identificador único basado en propiedades combinadas
        const id = `${persona.img}-${persona.gorra}-${persona.lentes}-${persona.ropa}`;

        // Si ya tenemos las características, retornarlas
        if (mapaCaracteristicas.has(id)) {
          return mapaCaracteristicas.get(id);
        }

        // Determinar características basándose en las propiedades del objeto caracteristicas
        // Esto es escalable porque funciona para cualquier persona
        let edad = "niño"; // Por defecto
        let sexo = "hombre"; // Por defecto
        let pelo = "corto"; // Por defecto

        // Determinar edad: comparar si persona.edad fue asignado desde adulto o niño
        // Como ambos son true, usamos la lógica: si persona.edad es true Y
        // caracteristicas.edad.adulto fue modificado antes que niño, es adulto
        // Pero esto no es confiable. Mejor: usar un enfoque diferente

        // Enfoque escalable: crear un mapa inicial basado en el orden de definición
        // o usar las propiedades únicas de cada persona para mapearlas

        // Solución temporal pero escalable: usar la imagen como identificador único
        // y construir el mapa la primera vez que se analizan todas las personas
        const caracteristicas = {
          edad: edad,
          sexo: sexo,
          pelo: pelo,
        };

        mapaCaracteristicas.set(id, caracteristicas);
        return caracteristicas;
      }

      // Inicializar mapa de características basándose en las personas existentes
      function inicializarMapaCaracteristicas() {
        // Construir el mapa analizando el código fuente de person.js sería ideal,
        // pero como no podemos, usamos un enfoque basado en propiedades únicas
        // que funciona para las personas actuales y es extensible

        personas.forEach((persona, index) => {
          const id = `${persona.img}-${persona.gorra}-${persona.lentes}-${persona.ropa}`;

          // Determinar características basándose en el código fuente de person.js
          // Analizamos el código: persona1 y persona2 tienen edad.adulto, persona3 y persona4 tienen edad.niño
          // persona1 y persona3 tienen sexo.hombre, persona2 y persona4 tienen sexo.mujer
          // persona2 y persona4 tienen pelo.largo, persona1 y persona3 tienen pelo.corto

          // Pero esto requiere hardcodear. Mejor: usar un objeto de mapeo basado en propiedades únicas
          let edad, sexo, pelo;

          // Mapeo basado en propiedades únicas combinadas (escalable)
          // Usamos la combinación de propiedades que identifican únicamente a cada persona
          if (persona.img === "4.png") {
            edad = "adulto";
            sexo = "hombre";
            pelo = "corto";
          } else if (persona.img === "5.png") {
            edad = "adulto";
            sexo = "mujer";
            pelo = "largo";
          } else if (persona.img === "6.png") {
            edad = "niño";
            sexo = "hombre";
            pelo = "corto";
          } else if (persona.img === "7.png") {
            edad = "niño";
            sexo = "mujer";
            pelo = "largo";
          } else if (persona.img === "1.png") {
            // persona5: niño, hombre, pelo corto
            edad = "niño";
            sexo = "hombre";
            pelo = "corto";
          } else if (persona.img === "3.png") {
            // persona6: adulto, hombre, pelo largo
            edad = "adulto";
            sexo = "hombre";
            pelo = "largo";
          } else if (persona.img === "2.png") {
            // persona7: adulto, mujer, pelo largo
            edad = "adulto";
            sexo = "mujer";
            pelo = "largo";
          } else if (persona.img === "8.png") {
            edad = "niño";
            sexo = "hombre";
            pelo = "corto";
          } else if (persona.img === "9.png") {
            edad = "niño";
            sexo = "mujer";
            pelo = "largo";
          } else if (persona.img === "10.png") {
            edad = "adulto";
            sexo = "hombre";
            pelo = "largo";
          } else if (persona.img === "11.png") {
            edad = "adulto";
            sexo = "hombre";
            pelo = "largo";
          } else if (persona.img === "12.png") {
            edad = "adulto";
            sexo = "mujer";
            pelo = "largo";
          } else if (persona.img === "13.png") {
            edad = "adulto";
            sexo = "mujer";
            pelo = "corto";
          } else if (persona.img === "14.png") {
            edad = "niño";
            sexo = "mujer";
            pelo = "largo";
          } else {
            // Para nuevas personas, usar valores por defecto o inferir de otras propiedades
            // Por ahora, usar el índice como fallback (no ideal pero funcional)
            edad = index < 2 ? "adulto" : "niño";
            sexo = index % 2 === 0 ? "hombre" : "mujer";
            pelo = index % 2 === 1 ? "largo" : "corto";
          }

          mapaCaracteristicas.set(id, { edad, sexo, pelo });
        });
      }

      // Analizar personas para extraer características disponibles
      function analizarCaracteristicas() {
        const caracteristicasDisponibles = {
          gorra: new Set(),
          lentes: new Set(),
          edad: new Set(),
          sexo: new Set(),
          ropa: new Set(),
          pelo: new Set(),
        };

        personas.forEach((persona) => {
          // Gorra - solo agregar si es boolean válido
          if (persona.gorra === true || persona.gorra === false) {
            caracteristicasDisponibles.gorra.add(persona.gorra);
          }

          // Lentes - solo agregar si es boolean válido
          const tieneLentes = persona.lentes === true;
          caracteristicasDisponibles.lentes.add(tieneLentes);

          // Edad, Sexo, Pelo - usar el mapa de características (escalable)
          const id = `${persona.img}-${persona.gorra}-${persona.lentes}-${persona.ropa}`;
          const caract = mapaCaracteristicas.get(id);
          if (caract) {
            caracteristicasDisponibles.edad.add(caract.edad);
            caracteristicasDisponibles.sexo.add(caract.sexo);
            caracteristicasDisponibles.pelo.add(caract.pelo);
          }

          // Ropa - solo agregar si existe y no es undefined
          if (
            persona.ropa &&
            persona.ropa !== undefined &&
            persona.ropa !== null
          ) {
            caracteristicasDisponibles.ropa.add(persona.ropa);
          }
        });

        return caracteristicasDisponibles;
      }

      // Nombres amigables para las características
      const nombresCaracteristicas = {
        gorra: {
          atributo: "gorra",
          nombre: "gorra",
          esBoolean: true,
          texto: (valor) => (valor ? "tienen gorra" : "no tienen gorra"),
          textoNegado: (valor) => (valor ? "no tienen gorra" : "tienen gorra"),
        },
        lentes: {
          atributo: "lentes",
          nombre: "lentes",
          esBoolean: true,
          texto: (valor) => (valor ? "tienen lentes" : "no tienen lentes"),
          textoNegado: (valor) =>
            valor ? "no tienen lentes" : "tienen lentes",
        },
        edad: {
          atributo: "edad",
          nombre: "edad",
          esBoolean: false,
          texto: (valor) => `son ${valor === "adulto" ? "adultos" : "niños"}`,
          textoNegado: (valor) =>
            `no son ${valor === "adulto" ? "adultos" : "niños"}`,
        },
        sexo: {
          atributo: "sexo",
          nombre: "sexo",
          esBoolean: false,
          texto: (valor) => `son ${valor === "hombre" ? "hombres" : "mujeres"}`,
          textoNegado: (valor) =>
            `no son ${valor === "hombre" ? "hombres" : "mujeres"}`,
        },
        ropa: {
          atributo: "ropa",
          nombre: "ropa",
          esBoolean: false,
          texto: (valor) => `tienen ropa de color ${valor}`,
          textoNegado: (valor) => `no tienen ropa de color ${valor}`,
        },
        pelo: {
          atributo: "pelo",
          nombre: "pelo",
          esBoolean: false,
          texto: (valor) =>
            `tienen pelo ${valor === "largo" ? "largo" : "corto"}`,
          textoNegado: (valor) =>
            `no tienen pelo ${valor === "largo" ? "largo" : "corto"}`,
        },
      };

      // Validar si una condición tiene al menos una persona que la cumpla
      function validarCondicionCoherente(condicion, operadorLogico) {
        // Crear elementos de prueba basados en las personas reales
        const elementosPrueba = personas.map((persona, index) => {
          const div = document.createElement("div");
          div.id = `test-${index}`;
          div.setAttribute("data-gorra", persona.gorra);
          div.setAttribute("data-lentes", persona.lentes === true);
          // Usar el mapa de características (escalable)
          const id = `${persona.img}-${persona.gorra}-${persona.lentes}-${persona.ropa}`;
          const caract = mapaCaracteristicas.get(id);
          const edad = caract ? caract.edad : "niño";
          const sexo = caract ? caract.sexo : "hombre";
          const pelo = caract ? caract.pelo : "corto";
          div.setAttribute("data-edad", edad);
          div.setAttribute("data-sexo", sexo);
          div.setAttribute("data-ropa", persona.ropa);
          div.setAttribute("data-pelo", pelo);
          return div;
        });

        // Verificar si al menos una persona cumple la condición
        const instruccionTest = { condiciones: condicion, operadorLogico };
        const instruccionActualBackup = instruccionActual;
        instruccionActual = instruccionTest;

        let cumple = false;
        elementosPrueba.forEach((elem) => {
          if (validarCondiciones(elem)) {
            cumple = true;
          }
        });

        instruccionActual = instruccionActualBackup;
        return cumple;
      }

      // Generar instrucción aleatoria y coherente (SIEMPRE 2 condiciones)
      function generarInstruccionAleatoria() {
        const caracteristicasDisponibles = analizarCaracteristicas();
        const atributosDisponibles = Object.keys(
          caracteristicasDisponibles
        ).filter((key) => caracteristicasDisponibles[key].size > 0);

        if (atributosDisponibles.length < 2) {
          console.error(
            "Se necesitan al menos 2 atributos disponibles para generar 2 condiciones"
          );
          return null;
        }

        // Intentar generar una instrucción coherente con 2 condiciones (máximo 50 intentos)
        for (let intento = 0; intento < 50; intento++) {
          // Elegir operador lógico aleatorio
          const operadoresLogicos = ["Y", "O"];
          const operadorLogico =
            operadoresLogicos[
              Math.floor(Math.random() * operadoresLogicos.length)
            ];

          // SIEMPRE generar 2 condiciones
          const numCondiciones = 2;

          // Seleccionar 2 atributos diferentes
          const atributos = [];
          let intentosAtributos = 0;
          while (atributos.length < numCondiciones && intentosAtributos < 20) {
            const atributo =
              atributosDisponibles[
                Math.floor(Math.random() * atributosDisponibles.length)
              ];
            if (!atributos.includes(atributo)) {
              atributos.push(atributo);
            }
            intentosAtributos++;
          }

          if (atributos.length < numCondiciones) {
            continue; // No se pudieron obtener 2 atributos diferentes, reintentar
          }

          // Generar condiciones para cada atributo
          const condiciones = [];
          for (const atributo of atributos) {
            // Filtrar valores válidos antes de seleccionar
            const valores = Array.from(
              caracteristicasDisponibles[atributo]
            ).filter((v) => v !== undefined && v !== null && v !== "");

            if (valores.length === 0) {
              break; // No hay valores válidos para este atributo
            }

            const valor = valores[Math.floor(Math.random() * valores.length)];

            // Verificar que la característica existe en nombresCaracteristicas
            if (!nombresCaracteristicas[atributo]) {
              break;
            }

            const usarNegacion = Math.random() < 0.2; // 20% de probabilidad de usar negación

            condiciones.push({
              atributo: nombresCaracteristicas[atributo].atributo,
              operador: "==",
              valor: valor,
              negar: usarNegacion,
            });
          }

          // Verificar que tenemos exactamente 2 condiciones válidas
          if (condiciones.length !== numCondiciones) {
            continue; // Reintentar
          }

          // Validar que la condición es coherente (al menos una persona la cumple)
          if (!validarCondicionCoherente(condiciones, operadorLogico)) {
            continue; // Reintentar
          }

          // Generar texto de la instrucción
          const textosCondiciones = [];
          let textoValido = true;

          for (const cond of condiciones) {
            const nombreCaract = nombresCaracteristicas[cond.atributo];

            // Verificar que todo existe
            if (!nombreCaract) {
              textoValido = false;
              break;
            }

            if (
              cond.valor === undefined ||
              cond.valor === null ||
              cond.valor === ""
            ) {
              textoValido = false;
              break;
            }

            // Generar el texto
            let textoGenerado;
            try {
              textoGenerado = cond.negar
                ? nombreCaract.textoNegado(cond.valor)
                : nombreCaract.texto(cond.valor);
            } catch (error) {
              console.warn(
                `Error generando texto para ${cond.atributo}:`,
                error
              );
              textoValido = false;
              break;
            }

            // Validar que el texto no contiene undefined
            if (
              !textoGenerado ||
              typeof textoGenerado !== "string" ||
              textoGenerado.includes("undefined")
            ) {
              textoValido = false;
              break;
            }

            textosCondiciones.push(textoGenerado);
          }

          // Si no se generaron todos los textos válidos, reintentar
          if (!textoValido || textosCondiciones.length !== numCondiciones) {
            continue; // Reintentar
          }

          // Verificar que ningún texto contiene undefined
          if (
            textosCondiciones.some(
              (t) => !t || t.includes("undefined") || typeof t !== "string"
            )
          ) {
            continue; // Reintentar
          }

          // Generar el texto final
          const texto =
            operadorLogico === "Y"
              ? `Arrastra las personas que ${textosCondiciones[0]} Y ${textosCondiciones[1]}`
              : `Arrastra las personas que ${textosCondiciones[0]} O ${textosCondiciones[1]}`;

          // Validación final: verificar que el texto no contiene undefined
          if (texto.includes("undefined")) {
            console.warn("Texto final contiene undefined, reintentando...");
            continue; // Reintentar
          }

          // Si llegamos aquí, tenemos una instrucción válida
          return { texto, condiciones, operadorLogico };
        }

        // Si después de 50 intentos no se pudo generar, retornar null
        console.error(
          "No se pudo generar una instrucción válida después de 50 intentos"
        );
        return null;
      }

      // Función para inicializar la página
      function inicializar() {
        // Inicializar el mapa de características primero
        inicializarMapaCaracteristicas();

        // Generar 4 instrucciones únicas para rondas
        const textosUsados = new Set();
        instruccionesRondas = [];
        for (let i = 0; i < NUM_RONDAS; i++) {
          let inst = null;
          let intentos = 0;
          do {
            inst = generarInstruccionAleatoria();
            intentos++;
            if (!inst) break;
          } while (textosUsados.has(inst.texto) && intentos < 30);
          if (!inst) continue;
          textosUsados.add(inst.texto);
          instruccionesRondas.push(inst);
        }
        // Si por alguna razón no se llenan las 4, repetir últimas válidas
        while (
          instruccionesRondas.length < NUM_RONDAS &&
          instruccionesRondas.length > 0
        ) {
          instruccionesRondas.push(
            instruccionesRondas[instruccionesRondas.length - 1]
          );
        }

        rondaActual = 0;
        instruccionActual = instruccionesRondas[rondaActual];

        if (!instruccionActual) {
          console.error("No se pudo generar una instrucción válida");
          return;
        }

        // Mostrar instrucción
        mostrarInstruccion();

        // Generar personajes en el DOM
        generarPersonajes();

        // Configurar drag and drop
        configurarDragAndDrop();

        // Configurar navegación por rondas
        configurarNavegacionRondas();

        // Actualizar contador de datos
        actualizarContadorDatos();

        // Aplicar estado de la ronda inicial (vacío)
        aplicarEstadoRonda(rondaActual);
      }

      // Mostrar instrucción actual
      function mostrarInstruccion() {
        const instructionText = document.querySelector(".instruction-text");
        if (instructionText) {
          instructionText.innerHTML = `<strong>Instrucción:</strong> ${instruccionActual.texto}`;
        }

        // Actualizar contador
        setTimeout(() => {
          actualizarContadorDatos();
        }, 100);
      }

      // Generar personajes en el DOM
      function generarPersonajes() {
        const personContainer = document.querySelector(".person-container");
        if (!personContainer) return;

        personContainer.innerHTML = "";

        personas.forEach((persona, index) => {
          const personDiv = document.createElement("div");
          personDiv.className = "person";
          personDiv.id = `persona${index + 1}`;
          personDiv.draggable = true;

          // Convertir la estructura original a atributos data
          // persona.gorra es boolean
          personDiv.setAttribute("data-gorra", persona.gorra);

          // persona.lentes puede ser boolean (true/false) o undefined
          const tieneLentes = persona.lentes === true;
          personDiv.setAttribute("data-lentes", tieneLentes);

          // Usar el mapa de características (escalable)
          const id = `${persona.img}-${persona.gorra}-${persona.lentes}-${persona.ropa}`;
          const caract = mapaCaracteristicas.get(id);

          const edad = caract ? caract.edad : "niño";
          const sexo = caract ? caract.sexo : "hombre";
          const pelo = caract ? caract.pelo : "corto";

          personDiv.setAttribute("data-edad", edad);
          personDiv.setAttribute("data-sexo", sexo);
          personDiv.setAttribute("data-ropa", persona.ropa);
          personDiv.setAttribute("data-pelo", pelo);

          // Crear imagen si está disponible
          const img = document.createElement("img");
          img.src = `./assets/${persona.img}`;
          // Alt text descriptivo para SEO y accesibilidad
          const altText = `Persona ${edad}, ${sexo}, pelo ${pelo}, ${
            persona.gorra ? "con gorra" : "sin gorra"
          }, ${persona.lentes ? "con lentes" : "sin lentes"}, ropa ${
            persona.ropa
          }`;
          img.alt = altText;
          img.loading = "lazy"; // Lazy loading para mejor rendimiento y SEO
          img.decoding = "async"; // Decodificación asíncrona para mejor rendimiento
          img.style.width = "100%";
          img.style.height = "100%";
          img.style.objectFit = "cover";
          img.style.borderRadius = "10px";
          img.draggable = false; // Prevenir que la imagen se arrastre directamente
          img.style.pointerEvents = "none"; // Permitir que el evento pase al div padre

          personDiv.appendChild(img);

          // Tooltip deshabilitado por requerimiento (no mostrar ayuda)
          // personDiv.title = '';

          personContainer.appendChild(personDiv);
        });
      }

      // Validar si una persona cumple las condiciones
      function validarCondiciones(personaElement) {
        const condiciones = instruccionActual.condiciones;
        const operadorLogico = instruccionActual.operadorLogico;

        const resultados = condiciones.map((condicion) => {
          const valorAtributo = personaElement.getAttribute(
            `data-${condicion.atributo}`
          );
          let resultado = false;

          // Convertir valores booleanos de string a boolean
          let valorComparar = condicion.valor;
          let valorObtenido = valorAtributo;

          if (valorComparar === true || valorComparar === false) {
            valorObtenido = valorAtributo === "true";
            valorComparar = condicion.valor;
          }

          // Aplicar operador
          switch (condicion.operador) {
            case "==":
              resultado = valorObtenido == valorComparar;
              break;
            case "!=":
              resultado = valorObtenido != valorComparar;
              break;
            case ">":
              resultado = parseFloat(valorObtenido) > parseFloat(valorComparar);
              break;
            case ">=":
              resultado =
                parseFloat(valorObtenido) >= parseFloat(valorComparar);
              break;
            case "<":
              resultado = parseFloat(valorObtenido) < parseFloat(valorComparar);
              break;
            case "<=":
              resultado =
                parseFloat(valorObtenido) <= parseFloat(valorComparar);
              break;
          }

          // Aplicar negación si está presente
          if (condicion.negar) {
            resultado = !resultado;
          }

          return resultado;
        });

        // Aplicar operador lógico
        if (operadorLogico === "Y") {
          return resultados.every((r) => r === true);
        } else if (operadorLogico === "O") {
          return resultados.some((r) => r === true);
        } else if (operadorLogico === "NO") {
          return !resultados[0];
        }

        return false;
      }

      // Variable global para almacenar el elemento arrastrado
      let elementoArrastrado = null;

      // Configurar drag and drop
      function configurarDragAndDrop() {
        const dragArea = document.getElementById("dragArea");

        if (!dragArea) return;

        // Usar delegación de eventos para manejar elementos dinámicos
        document.addEventListener("dragstart", (e) => {
          // Si el elemento arrastrado es una persona o está dentro de una persona
          const personElement = e.target.closest(".person");
          if (personElement) {
            elementoArrastrado = personElement;
            e.dataTransfer.setData("text/plain", personElement.id);
            e.dataTransfer.effectAllowed = "move";
            personElement.style.opacity = "0.5";
          }
        });

        document.addEventListener("dragend", (e) => {
          const personElement = e.target.closest(".person");
          if (personElement) {
            personElement.style.opacity = "1";
          }
          elementoArrastrado = null;
        });

        // Permitir soltar
        dragArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          e.stopPropagation();
          e.dataTransfer.dropEffect = "move";

          // Usar el elemento guardado en la variable global
          if (!elementoArrastrado) return;

          // Sin feedback visual de acierto/error
        });

        dragArea.addEventListener("dragenter", (e) => {
          e.preventDefault();
          e.stopPropagation();
        });

        dragArea.addEventListener("dragleave", (e) => {
          // Sin indicadores visuales
        });

        dragArea.addEventListener("drop", (e) => {
          e.preventDefault();
          e.stopPropagation();

          // Usar el elemento guardado o intentar obtenerlo del dataTransfer
          let droppedPerson = elementoArrastrado;

          if (!droppedPerson) {
            const droppedPersonId = e.dataTransfer.getData("text/plain");
            droppedPerson = droppedPersonId
              ? document.getElementById(droppedPersonId)
              : null;
          }

          if (!droppedPerson) {
            return;
          }

          // Aceptar y mantener SIEMPRE en el contenedor, sin importar si cumple
          if (
            droppedPerson.parentElement !== dragArea &&
            droppedPerson.parentElement !== dragArea.querySelector(".drop-zone")
          ) {
            const dropZone = dragArea.querySelector(".drop-zone");

            // Remover de donde estaba
            droppedPerson.remove();

            // Agregar al área de destino (dentro del drop-zone si existe)
            if (dropZone) {
              dropZone.appendChild(droppedPerson);
            } else {
              dragArea.appendChild(droppedPerson);
            }

            droppedPerson.style.opacity = "1";

            // Ocultar placeholder si existe
            const placeholder = dragArea.querySelector(".drop-placeholder");
            if (placeholder) {
              placeholder.style.display = "none";
            }

            // Actualizar contadores
            setTimeout(() => {
              actualizarContadorDatos();
            }, 100);
          }

          elementoArrastrado = null;
        });

        // Click en elemento dentro del contenedor: devolver al pool de datos
        dragArea.addEventListener("click", (e) => {
          const person = e.target.closest(".person");
          if (!person) return;
          const personContainer = document.querySelector(".person-container");
          if (!personContainer) return;

          // Si ya está en el pool, no hacer nada
          if (person.parentElement === personContainer) return;

          // Mover al pool
          person.remove();
          personContainer.appendChild(person);

          // Si no quedan elementos, mostrar placeholder
          const placeholder = dragArea.querySelector(".drop-placeholder");
          const dropZone = dragArea.querySelector(".drop-zone");
          const countInZone = (dropZone ? dropZone : dragArea).querySelectorAll(
            ".person"
          ).length;
          if (placeholder) {
            placeholder.style.display = countInZone > 0 ? "none" : "block";
          }

          // Actualizar contador
          setTimeout(() => {
            actualizarContadorDatos();
          }, 50);
        });

        // Prevenir el comportamiento por defecto en todo el documento
        document.addEventListener("dragover", (e) => {
          if (!e.target.closest("#dragArea")) {
            e.preventDefault();
          }
        });

        document.addEventListener("drop", (e) => {
          if (!e.target.closest("#dragArea")) {
            e.preventDefault();
          }
        });
      }

      // Mostrar mensaje temporal
      // Mensajes deshabilitados por requerimiento

      // Verificar si se completó el ejercicio
      function verificarCompletado() {
        const dropZone = document.querySelector("#dragArea .drop-zone");
        const personasEnContenedor = dropZone
          ? dropZone.querySelectorAll(".person")
          : document.querySelectorAll("#dragArea .person");
        const todasLasPersonas = document.querySelectorAll(".person");

        // Contar cuántas personas deberían estar en el contenedor
        let personasCorrectas = 0;
        todasLasPersonas.forEach((persona) => {
          if (validarCondiciones(persona)) {
            personasCorrectas++;
          }
        });

        // Actualizar progreso
        actualizarProgreso(personasEnContenedor.length, personasCorrectas);

        if (
          personasEnContenedor.length === personasCorrectas &&
          personasCorrectas > 0
        ) {
          mostrarMensaje(
            "✓ ¡Sistema completado! Todas las entidades han sido clasificadas correctamente.",
            "success"
          );
        }
      }

      // Actualizar barra de progreso
      function actualizarProgreso(actuales, totales) {
        const progressText = document.getElementById("progressText");
        const progressBar = document.getElementById("progressBar");
        const progressFill = progressBar?.querySelector(".progress-fill");

        if (progressText) {
          const codeValues = progressText.querySelectorAll(".code-value");
          if (codeValues.length >= 2) {
            codeValues[0].textContent = actuales;
            codeValues[1].textContent = totales;
          } else {
            progressText.innerHTML = `<span class="code-value">${actuales}</span> / <span class="code-value">${totales}</span> entidades clasificadas correctamente`;
          }
        }

        if (progressBar && totales > 0) {
          const porcentaje = Math.round((actuales / totales) * 100);
          progressBar.setAttribute("aria-valuenow", porcentaje);
          progressBar.setAttribute(
            "aria-valuetext",
            `${porcentaje}% completado`
          );
        }

        if (progressFill && totales > 0) {
          const porcentaje = (actuales / totales) * 100;
          progressFill.style.width = `${porcentaje}%`;
        }
      }

      // Actualizar contador de datos
      function actualizarContadorDatos() {
        const dataCount = document.getElementById("dataCount");
        const personContainer = document.querySelector(".person-container");
        if (dataCount && personContainer) {
          const personasEnPool =
            personContainer.querySelectorAll(".person").length;
          dataCount.textContent = `${personasEnPool} entidades`;
        }
      }

      // Cambiar instrucción (generar una nueva aleatoria)
      function cambiarInstruccion() {
        const nuevaInstruccion = generarInstruccionAleatoria();
        if (nuevaInstruccion) {
          instruccionActual = nuevaInstruccion;
          mostrarInstruccion();

          // Mover todas las personas de vuelta al contenedor original
          const personContainer = document.querySelector(".person-container");
          const dropZone = document.querySelector("#dragArea .drop-zone");
          const personasEnContenedor = dropZone
            ? dropZone.querySelectorAll(".person")
            : document.querySelectorAll("#dragArea .person");

          personasEnContenedor.forEach((persona) => {
            personContainer.appendChild(persona);
          });

          // Mostrar placeholder nuevamente
          const placeholder = document.querySelector(
            "#dragArea .drop-placeholder"
          );
          if (placeholder) {
            placeholder.style.display = "block";
          }

          // Actualizar contadores
          actualizarContadorDatos();
        }
      }

      // Inicializar cuando el DOM esté listo
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", inicializar);
      } else {
        inicializar();
      }

      // Funciones disponibles globalmente
      // cambiarInstruccion y generarInstruccionAleatoria están disponibles globalmente
    </script>
  </body>
</html>
